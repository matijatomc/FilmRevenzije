{% extends 'home.html' %}

{% block content %}
<h2>Moje recenzije</h2>
{% for recenzija in recenzije %}
    <li>
        <h4>{{ recenzija.film.nazivFilma }}</h4>
        <p>Autor: {{ recenzija.autorRecenzije }}</p>
        <p>Ocjena: {{ recenzija.ocjena }}</p>
        <p>Recenzija: {{ recenzija.recenzija }}</p>
        {% if user.is_authenticated and recenzija.autorRecenzije == user %}
            <form method="post" action="{% url 'main:edit_review' recenzija.id %}" style="display: none;">
                {% csrf_token %}
                {{ form.as_p }}
                <button type="submit">Save Changes</button>
            </form>
            <button class="edit-button" data-review-id="{{ recenzija.id }}">Edit Review</button>
            
            <!-- Delete Review Confirmation -->
            <form id="delete-review-form-{{ recenzija.id }}" method="post" action="{% url 'main:delete_review' recenzija.id %}" style="display: none;">
                {% csrf_token %}
                <button type="submit">Delete Review</button>
            </form>
            <button class="delete-button" data-review-id="{{ recenzija.id }}">Delete Review</button>
        {% endif %}
    </li>
{% endfor %}

<script>
    // Add a click event listener to edit buttons for the user's own reviews
    document.querySelectorAll('.edit-button').forEach(function(button) {
        button.addEventListener('click', function() {
            var reviewId = this.getAttribute('data-review-id');
            var form = document.querySelector('form[action="{% url "main:edit_review" 0 %}"]'.replace('0', reviewId));
            form.style.display = form.style.display === 'none' ? 'block' : 'none';
        });
    });

    // Add a click event listener to delete buttons for the user's own reviews
    document.querySelectorAll('.delete-button').forEach(function(button) {
        button.addEventListener('click', function() {
            var reviewId = this.getAttribute('data-review-id');
            var confirmation = confirm("Are you sure you want to delete this review?");
            if (confirmation) {
                document.getElementById('delete-review-form-' + reviewId).submit();
            }
        });
    });
</script>

{% endblock %}